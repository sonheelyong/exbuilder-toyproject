<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="class">

   <select id="getclass"
   parameterType="String"
   resultType="com.example.demo.vo.ClassDTO">
   SELECT a.code, a.teacher, a.class_name, a.s_date, a.e_date, b.regi_date
   FROM class_tb a
   LEFT OUTER JOIN regi_tb b ON a.code = b.code AND b.user_id = #{user_id}
   ORDER BY a.code ASC
   </select>
   
   <select id="serchclass"
   parameterType="HashMap"
   resultType="com.example.demo.vo.ClassDTO">
   SELECT a.code, a.teacher, a.class_name, a.s_date, a.e_date, b.regi_date
   FROM class_tb a
   LEFT OUTER JOIN regi_tb b ON a.code = b.code AND b.user_id = #{user_id}
   WHERE UPPER(a.CLASS_NAME) LIKE '%'||UPPER(#{name})||'%'
   ORDER BY a.code ASC
   </select>

   <insert id="regiClass"
    parameterType="HashMap">
    INSERT INTO REGI_TB (REGI_NO, USER_ID, CODE)
    VALUES (emp_seq.NEXTVAL, #{user_id}, #{code})   
   </insert>
   
   <select id="checkClass"
   resultType="Int" parameterType="HashMap">
   SELECT count(*)
   FROM REGI_TB
   WHERE CODE = #{code} and USER_ID = #{user_id}
   </select>
   
   <delete id="cancle"
   parameterType="HashMap">
   DELETE FROM REGI_TB
   WHERE CODE = #{code} and USER_ID = #{user_id}
   </delete>
   
   <update id="updateclass"
   parameterType="com.example.demo.vo.ClassVo" >
	UPDATE CLASS_TB
	SET
	CLASS_NAME = #{class_name},
	TEACHER = #{teacher},
	S_DATE = #{s_date},
	E_DATE = #{e_date}
	WHERE
    CODE = #{code}
   </update>
   
   <select id="checkCode"
    parameterType="int"
    resultType="int">
    
   select count(*)
   from class_tb
   where code = #{code}
   </select>
   
   <insert id="addclass"
   parameterType="com.example.demo.vo.ClassVo" >
   INSERT INTO CLASS_TB (CODE, TEACHER, CLASS_NAME, S_DATE, E_DATE)
   VALUES               (emp_seq.NEXTVAL, #{teacher}, #{class_name}, #{s_date}, #{e_date})
   </insert>
   
   <delete id="deleteclass"
   parameterType="int">
   delete from class_tb
   where code = #{code}
   </delete>
   
    <select id="getcoderegi"
    parameterType="int"
    resultType="com.example.demo.vo.RegiVo">
    
   select regi_no, user_id, regi_date
   from regi_tb
   where code = #{code}
   </select>
   
   <select id="getcodeclass"
    parameterType="int"
    resultType="com.example.demo.vo.ClassVo">
    
   select *
   from class_tb
   where code = #{code}
   </select>
   
   <delete id="deleteregi_no"
   parameterType="int">
   
   delete from regi_tb
   where regi_no = #{regi_no}
   </delete>
   
   <select id="getRegiList"
   parameterType="String"
   resultType="com.example.demo.vo.ClassDTO">
   
   select a.code, a.teacher, a.class_name, a.s_date, a.e_date, b.user_id, b.regi_date 
   from class_tb a, regi_tb b
   where b.code = a.code and b.user_id = #{user_id}
   </select>
</mapper>
